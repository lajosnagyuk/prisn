---
# Example 1: Simple inline Python HTTP server
apiVersion: prisn.io/v1alpha1
kind: PrisnApp
metadata:
  name: hello-http
spec:
  runtime: python3
  replicas: 2
  port: 8080
  source:
    inline: |
      from http.server import HTTPServer, BaseHTTPRequestHandler
      import json
      import os

      class Handler(BaseHTTPRequestHandler):
          def do_GET(self):
              if self.path == '/health':
                  self.send_response(200)
                  self.send_header('Content-Type', 'application/json')
                  self.end_headers()
                  self.wfile.write(json.dumps({"status": "healthy"}).encode())
              else:
                  self.send_response(200)
                  self.send_header('Content-Type', 'text/plain')
                  self.end_headers()
                  hostname = os.environ.get('HOSTNAME', 'unknown')
                  self.wfile.write(f"Hello from {hostname}!\n".encode())

      if __name__ == '__main__':
          server = HTTPServer(('0.0.0.0', 8080), Handler)
          print("Starting server on port 8080...")
          server.serve_forever()
    entrypoint: script
  healthCheck:
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 10
  resources:
    cpu: "100m"
    memory: "128Mi"
    requests:
      cpu: "50m"
      memory: "64Mi"

---
# Example 2: Node.js API from ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: node-api-source
data:
  server.js: |
    const http = require('http');

    const server = http.createServer((req, res) => {
      if (req.url === '/health') {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({ status: 'ok' }));
      } else {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({
          message: 'Hello from Node.js!',
          timestamp: new Date().toISOString()
        }));
      }
    });

    server.listen(3000, () => {
      console.log('Server running on port 3000');
    });
---
apiVersion: prisn.io/v1alpha1
kind: PrisnApp
metadata:
  name: node-api
spec:
  runtime: node
  replicas: 1
  port: 3000
  source:
    configMapRef:
      name: node-api-source
    entrypoint: server.js
  healthCheck:
    path: /health
  resources:
    cpu: "200m"
    memory: "256Mi"

---
# Example 3: Worker process (no port)
apiVersion: prisn.io/v1alpha1
kind: PrisnApp
metadata:
  name: background-worker
spec:
  runtime: python3
  replicas: 1
  source:
    inline: |
      import time
      import os

      worker_id = os.environ.get('HOSTNAME', 'worker')
      print(f"Worker {worker_id} starting...")

      while True:
          print(f"[{worker_id}] Processing work...")
          time.sleep(10)
    entrypoint: script
  env:
    - name: LOG_LEVEL
      value: "info"
  resources:
    cpu: "50m"
    memory: "64Mi"
